<!-- <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="/">Advisor</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse"
    data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

</header> -->
<nav class="navbar navbar-dark bg-primary">
  <div class="mx-3 container-fluid">
    <a href=""> <span class="navbar-brand h1">Advisor</span></a>
  </div>
</nav>

<div class="container-fluid">
  <div class="container my-3">
    <main>
      <div *ngIf="!this.db && !this.uploading">
        <div class="jumbotron">
          <h1 class="display-4">Hello, there!</h1>
          <p class="lead">This is the first demo for the log investigator Advisor.</p>
          <hr class="my-4">
          <p>Start uploading and analysing logs now!</p>
          <p class="lead">
            <label class="btn btn-primary btn-lg">
              <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                class="bi bi-cloud-arrow-up" viewBox="0 0 19 19">
                <path fill-rule="evenodd"
                  d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z" />
                <path
                  d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z" />
              </svg>
              UPLOAD <input type='file' (change)="onSelectFile($event)" class="invisible"
                style="width: 0; height: 0;"></label>
          </p>
        </div>
        <div *ngIf="savedReports" class="raw" style="margin-top: 20rem;">
          <div class="container">
            <h4>Recent analysis</h4>
          </div>
          <div class="list-group">
            <a *ngFor="let savedReport of savedReports" (click)="loadSavedReport(savedReport)" href="#"
              class="list-group-item list-group-item-action">
              <div class="d-flex justify-content-between">
                <p>{{savedReport.fileName}}</p>
                <p class="badge bg-primary"> {{savedReport.date|date:'yyyy-MM-dd HH:mm:ss'}}</p>
              </div>
              <small> {{savedReport.data.length}} exceptions found.</small>
            </a>
          </div>
        </div>
      </div>
      <div class="container" *ngIf="this.uploading">
        <div class="d-flex justify-content-center mt-5">
          <button class="btn btn-primary" type="button" disabled>
            <span class="spinner-grow spinner-grow-sm me-3" role="status" aria-hidden="true"></span> {{this.uploading}}
          </button>
        </div>
        <div *ngIf="folderFiles" class="container-fluid p-5">
          <!-- <p class="fw-bold p-2">Found files : </p> -->
          <!-- <ul class="list-group">
            <li *ngFor="let file of folderFiles"
              class="list-group-item d-flex justify-content-between align-items-center">
              {{file.fileName}}
              <span [ngClass]="file.count > 0 ? 'bg-danger' : ''"
                class="badge rounded-pill bg-primary">{{file.count}}</span>
            </li>
          </ul> -->
          <div *ngIf="folderFiles" class="shadow-lg rounded console-body p-2">
            <div id="screen" class="container">
              <b id="prompt" class="idle">&marker;</b>
            </div>
          </div>
        </div>
      </div>
      <div class="" *ngIf="db && db.length == 0 && !log">
        <div class="row">
          <div class="col-md-12">
            <div class="error-template">
              <h1> Oops!</h1>
              <h2> This log seems to be from a different era</h2>
              <div class="error-details">
                We would like to help you next time, it would be great if you shared this file with us. Thanks!
              </div>
              <div class="error-actions">
                <a href="" class="btn btn-primary btn-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                    class="bi bi-house-door-fill" viewBox="0 0 19 19">
                    <path
                      d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5z" />
                  </svg>
                  Take Me Home </a>
                <a href="" class="btn btn-secondary btn-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                    class="bi bi-envelope" viewBox="0 0 19 19">
                    <path
                      d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z" />
                  </svg>
                  Contact Support </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="" *ngIf="db && db.length > 0 && !log">
        <div class="row">
          <div class="d-flex flex-md-nowrap my-3">
            <div class="input-group">
              <span class="input-group-text" id="basic-addon1"><svg xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24" width="24" height="24">
                  <path fill-rule="evenodd"
                    d="M7.72.22a.75.75 0 011.06 0l1.204 1.203A4.983 4.983 0 0112 1c.717 0 1.4.151 2.016.423L15.22.22a.75.75 0 011.06 1.06l-.971.972A4.988 4.988 0 0117 6v1.104a2.755 2.755 0 011.917 1.974l1.998-.999a.75.75 0 01.67 1.342L19 10.714V13.5l3.25.003a.75.75 0 110 1.5L19 15.001V16a7.02 7.02 0 01-.204 1.686.833.833 0 01.04.018l2.75 1.375a.75.75 0 11-.671 1.342l-2.638-1.319A7 7 0 0112 23a7 7 0 01-6.197-3.742l-2.758 1.181a.75.75 0 11-.59-1.378l2.795-1.199A7.007 7.007 0 015 16v-.996H1.75a.75.75 0 010-1.5H5v-2.79L2.415 9.42a.75.75 0 01.67-1.342l1.998.999A2.755 2.755 0 017 7.104V6a4.99 4.99 0 011.69-3.748l-.97-.972a.75.75 0 010-1.06zM8.5 7h7V6a3.5 3.5 0 10-7 0v1zm-2 3.266V9.75c0-.69.56-1.25 1.25-1.25h8.5c.69 0 1.25.56 1.25 1.25V16a5.5 5.5 0 01-11 0v-5.734z">
                  </path>
                </svg></span>
              <input type="text" class="form-control" placeholder="Search" aria-label="Search" [(ngModel)]="search"
                (keyup)="updateList() " aria-describedby="basic-addon1">
            </div>
          </div>
          <div class="col-6 ">
            <app-line-chart line [lineData]="lineData"></app-line-chart>
            <app-bubble-chart bubble [exception]="bubEx"></app-bubble-chart>
          </div>
          <app-pie-chart pie class="col-6 chart bg-body rounded shadow-lg p-2 my-2" (ex)="updateBubbleChart($event)"
            [exceptions]="exceptions">
          </app-pie-chart>
        </div>
        <div class="p-2 mt-3 ">
          <div class="row fw-bold shadow-lg border border-2 bg-body rounded">
            <div (click)="sortByName()" class="col-5 ">Name</div>
            <div (click)="sortByCount()" class="col-1">Count</div>
            <div (click)="sortByFirstOccurence()" class="col-3">First occurence</div>
            <div (click)="sortByLastOccurence()" class="col-3">Last occurence</div>
          </div>
        </div>

        <div *ngFor="let exception of exceptions; let e = index" class="shadow-lg p-2 mb-2 bg-body rounded">
          <a class="text-decoration-none text-dark" data-bs-toggle="collapse" href="#exception{{e}}" role="button"
            aria-expanded="false" [attr.aria-controls]="'exception' +e">
            <div class="row p-2">
              <div class="col-5 fw-bold">{{exception.exception.name}}</div>
              <div class="col-1">{{exception.count}}</div>
              <div class="col-3">{{exception.firstOccurence}}</div>
              <div class="col-3">{{exception.lastOccurence}}</div>
            </div>
          </a>
          <div class="collapse mb-2" id="exception{{e}}">
            <div class="card">
              <div class="card-header">
                <b>Message :</b> {{exception.message}}
              </div>
              <div *ngIf="!exception.hint.includes('No idea!')" class="card-body">
                <blockquote class="blockquote mb-0">
                  <p class="blockquote-footer"> <b>Hint : </b> {{exception.hint}}</p>
                  <p class="blockquote-footer"> <b>Todo : </b> {{exception.todo}}</p>
                </blockquote>
              </div>
            </div>
            <div class="container  mt-2  bg-body rounded shadow-lg border border-2 rounded">
              <div class="row fw-bold">
                <div class="col-3 d-flex justify-content-center">Date</div>
                <div class="col-4 d-flex justify-content-center">Logger</div>
                <div class="col-4 d-flex justify-content-center">Thread</div>
                <div class="col-1 d-flex justify-content-center">Level</div>
                <div></div>
              </div>
            </div>

            <div class="container mt-1  bg-body rounded shadow border border-1 rounded">
              <div *ngFor="let occurence of occurences(exception); let o = index" class="p-1 border-bottom">
                <a class="text-decoration-none text-dark" data-bs-toggle="collapse" href="#cb{{e}}-{{o}}" role="button"
                  aria-expanded="false" [attr.aria-controls]="'cb'+e+'-'+o">
                  <div class="row ">
                    <div class="col-3 d-flex justify-content-center">{{occurence.date}}</div>
                    <div class="col-4 d-flex justify-content-center">{{occurence.logger}}</div>
                    <div class="col-4 d-flex justify-content-center">{{occurence.thread}}</div>
                    <div class="col-1 d-flex justify-content-center">
                      <div level-color [level]='occurence.level' class="rounded px-2 fw-bold">
                        {{occurence.level}}
                      </div>
                    </div>
                  </div>
                </a>
                <div class="collapse container p-3 text-dark bg-white" id="cb{{e}}-{{o}}">
                  <div class="container p-3">
                    <div *ngFor="let cb of occurence.causedBy">
                      <p> {{cb}}</p>
                    </div>
                    <a data-bs-toggle="collapse" href="#seemore{{e}}-{{o}}" role="button" aria-expanded="false"
                      [attr.aria-controls]="'cb'+e+'-'+o">see more...</a>
                  </div>
                  <div class="collapse container p-3" id="seemore{{e}}-{{o}}">
                    {{occurence.stackTrace}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

    </main>
  </div>


</div>
